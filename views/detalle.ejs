
<%- include("template/head", {tituloWeb: "Detalle de mascota"}) %>
    

<div class="container">
    <h1>Detalle Mascota</h1>

   <% if (error) { %>

<p>
  <%= mensaje %>   
</p>
<a href="/mascotas" class="btn btn-dark btn-block">Volver a mascotas</a>
     
    <% } %>

    <% if (!error) { %>
        <!--ESTA ES LA PARTE DE LA EDICIÃ“N-->
     <form id="editarFormulario" action="" 
     data-id="<%= mascota.id %>"
          >
         <input 
         type="text"
         class="form-control my-2"
         name="nombre"
         value="<%= mascota.nombre %> "
         id="nombreInput"
         >
         <input 
         type="text"
         class="form-control my-2"
         name="texto"
         value="<%= mascota.texto %>"
         id="textoInput"
         >
         <input type="text"
         class="form-control my-2"
         name="descripcion"
         value="<%= mascota.descripcion %> "
         id="descripcionInput"
         >
         <button class="btn btn-warning btn-block"
                type="submit"
         >
         Editar
        </button>
     </form>
     <hr>




    <h1 class="btn-danger w-50 mx-auto">Aqui van las mascotas</h1>
   
    <div class="container">
        <h1>CRUD MongoDB</h1>
        <a class="btn btn-success btn-block my-4"
            href="/mascotas/crear"
        >
        Crear nueva mascota
        </a>
        <table class="table">
            <thead>
              <tr>
                <th scope="col">id</th>
                <th scope="col">Nombre</th>
                <th scope="col">Texto</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody>
                        <tr>
                            <th scope="row"><%= mascota.id %> </th>
                            <td><%= mascota.nombre %> </td>
                            <td><%= mascota.texto %> </td>
                            <td><%= mascota.descripcion %> </td>
                            <td>
                                <!--***DELETE***-->
                                <a 
                                href="/mascotas"
                                class="btn btn-danger btn-sm"
                                id="btnEliminar"
                                data-id="<%= mascota.id %>"
                                >
                                    Eliminar
                                </a>
                                        
                            </td>
                          </tr>             
            </tbody>
          </table>
      
    </div>

    <% } %>

<div class="card">
    <%- include("template/card") %> 
</div>
    


<%- include("template/footer") %>

</div>

<%- include("template/footer") %>

<script>
    //SCRIPT para ****DELETE****IMPORTANTE******
        const btnEliminar = document.querySelector('#btnEliminar')

        btnEliminar.addEventListener('click', async() =>{
            console.log('has dado un click')
            const id = btnEliminar.dataset.id

            try{
              const eliminarData = await fetch(`/mascotas/${id}`, {
                  method: 'delete'
              })
              const res = await data.json();
              
              if(res.estado){
                  window.location.href = '/mascotas'
              }else{
                  console.log(res)
                }
            }
            catch(error){
                console.log(error)
            }
        })


        // Editar el formulario

        const editarFormulario = document.querySelector('#editarFormulario')

        editarFormulario.addEventListener('submit', async(e)=>{
            //e. para evitar que se refresque el buscador
            e.preventDefault()
              
            const nombre = document.querySelector('#nombreInput').value
            const texto = document.querySelector('#textoInput').value
            const descripcion = document.querySelector('#descripcionInput').value
           const id = editarFormulario.dataset.id
           
           try {

            const data = await fetch(`/mascotas/${id}`, {
                method: 'put',
                headers: {
                    'Content-Type' : 'application/json'
                },
                body: JSON.stringify({
                    nombre: nombre,
                    texto: texto,
                    descripcion: descripcion
                })
            })
            const res = await data.json()
            console.log(res)

           }catch(error){
               console.log(error)
           }
        })
</script>
